<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Habit Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
  --bg:#0f172a;
  --panel:#111b32;
  --accent:#3b82f6;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --good:#22c55e;
}
*{box-sizing:border-box;font-family:system-ui,Segoe UI,Arial}
body{
  margin:0;
  background:linear-gradient(160deg,#020617,#0f172a);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:32px 16px 80px;
}
#app{
  max-width:900px;
  width:100%;
}
.card{
  background:rgba(17,25,53,0.8);
  border:1px solid rgba(255,255,255,0.07);
  border-radius:16px;
  padding:20px 22px;
  margin-bottom:16px;
  backdrop-filter:blur(16px);
}
h1,h2{margin:0 0 12px}
small{color:var(--muted)}
input,button{
  background:#0b1326;
  border:1px solid rgba(255,255,255,0.1);
  color:var(--text);
  border-radius:10px;
  padding:8px 10px;
}
button{cursor:pointer}
button.accent{
  background:var(--accent);
  border:none;
  color:white;
}
#habits{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.habit-tag{
  background:#0b1326;
  border:1px solid rgba(255,255,255,0.1);
  padding:6px 10px;
  border-radius:20px;
  display:flex;
  align-items:center;
  gap:6px;
}
.habit-tag span.remove{
  cursor:pointer;
  color:#f87171;
  font-weight:bold;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
}
.day{
  padding:10px 0;
  border-radius:10px;
  text-align:center;
  font-size:13px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.08);
}
.day.header{
  cursor:default;
  font-weight:600;
  color:var(--muted);
  border:none;
}
.day.other{opacity:0.25}
.day.done{
  background:rgba(34,197,94,0.15);
  border-color:rgba(34,197,94,0.5);
}
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
}
.stat{
  background:#0b1326;
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;
  padding:10px 14px;
}
.stat b{font-size:20px}
footer{
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-top:20px;
}
</style>
</head>
<body>
<div id="app">
  <div class="card">
    <h1>Habit Tracker</h1>
    <small id="yearInfo"></small>
  </div>

  <div class="card">
    <h2>Habits</h2>
    <div id="habits"></div>
    <br>
    <input id="habitInput" placeholder="Add new habitâ€¦">
    <button class="accent" onclick="addHabit()">Add</button>
  </div>

  <div class="card">
    <h2 id="monthLabel"></h2>
    <div class="calendar" id="calendar"></div>
    <small>Tap a day to toggle completion for all habits (green = all done)</small>
  </div>

  <div class="card">
    <h2>Analysis</h2>
    <div class="stats-grid">
      <div class="stat">Today: <br><b id="todayStat">0%</b></div>
      <div class="stat">This Week: <br><b id="weekStat">0%</b></div>
      <div class="stat">This Month: <br><b id="monthStat">0%</b></div>
      <div class="stat">This Year: <br><b id="yearStat">0%</b></div>
    </div>
  </div>

  <footer>
    Data is saved privately on your device (per year). Switching years creates a new dataset automatically.
  </footer>
</div>

<script>
// ---------- Storage & State ----------
const today = new Date();
let currentYear = today.getFullYear();
let currentMonth = today.getMonth();
const STORAGE_KEY = year => `habitTracker-${year}`;

function loadYear(year=currentYear){
  const raw = localStorage.getItem(STORAGE_KEY(year));
  return raw ? JSON.parse(raw) : {habits:[], logs:{}};
}
function saveYear(data,year=currentYear){
  localStorage.setItem(STORAGE_KEY(year),JSON.stringify(data));
}
let data = loadYear();

// ---------- Habits ----------
const habitsDiv = document.getElementById("habits");
function renderHabits(){
  habitsDiv.innerHTML="";
  data.habits.forEach((h,i)=>{
    const tag=document.createElement("div");
    tag.className="habit-tag";
    tag.innerHTML=`${h} <span class="remove" onclick="removeHabit(${i})">Ã—</span>`;
    habitsDiv.appendChild(tag);
  });
  saveYear(data);
  renderCalendar();
  updateStats();
}
function addHabit(){
  const input=document.getElementById("habitInput");
  const name=input.value.trim();
  if(!name) return;
  data.habits.push(name);
  input.value="";
  renderHabits();
}
function removeHabit(i){
  data.habits.splice(i,1);
  Object.keys(data.logs).forEach(k=>{
    if(data.logs[k]) delete data.logs[k];
  });
  renderHabits();
}

// ---------- Calendar ----------
const calDiv=document.getElementById("calendar");
const monthLabel=document.getElementById("monthLabel");
const yearInfo=document.getElementById("yearInfo");

function dateKey(d){return d.toISOString().slice(0,10);}
function getRange(start){
  const arr=[];
  const d=new Date(start);
  for(let i=0;i<42;i++){
    const n=new Date(d);
    n.setDate(start.getDate()+i);
    arr.push(n);
  }
  return arr;
}
function toggleDay(key){
  if(data.habits.length===0){
    alert("Add at least one habit first ðŸ™‚");
    return;
  }
  if(!data.logs[key]) data.logs[key]={};
  const doneCount=Object.values(data.logs[key]).filter(v=>v).length;
  const allDone = doneCount===data.habits.length;
  // Toggle: if already all done, reset; else mark all done
  data.logs[key]={};
  data.habits.forEach((_,i)=>{
    data.logs[key][i]=!allDone;
  });
  saveYear(data);
  renderCalendar();
  updateStats();
}

function renderCalendar(){
  yearInfo.textContent=`Year: ${currentYear}`;
  const first=new Date(currentYear,currentMonth,1);
  const start=new Date(first);
  start.setDate(first.getDate()-((first.getDay()+6)%7)); // Monday-start
  const days=getRange(start);

  monthLabel.textContent=first.toLocaleString("default",{month:"long",year:"numeric"});
  calDiv.innerHTML="";
  ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(d=>{
    const h=document.createElement("div");
    h.className="day header";
    h.textContent=d;
    calDiv.appendChild(h);
  });

  days.forEach(d=>{
    const cell=document.createElement("div");
    cell.className="day";
    if(d.getMonth()!==currentMonth) cell.classList.add("other");
    const key=dateKey(d);
    const logs=data.logs[key]||{};
    const doneCount=Object.values(logs).filter(v=>v).length;
    if(doneCount && doneCount===data.habits.length && data.habits.length>0){
      cell.classList.add("done");
    }
    cell.textContent=d.getDate();
    cell.onclick=()=>toggleDay(key);
    calDiv.appendChild(cell);
  });
}

// ---------- Stats ----------
function percent(done,total){
  if(total===0) return 0;
  return Math.round((done/total)*100);
}

function updateStats(){
  const todayKey=dateKey(today);
  const logsToday=data.logs[todayKey]||{};
  const todayPct=percent(
    Object.values(logsToday).filter(v=>v).length,
    data.habits.length
  );
  document.getElementById("todayStat").textContent=todayPct+"%";

  // week range (Mon-Sun)
  const wd=(today.getDay()+6)%7;
  const weekStart=new Date(today);
  weekStart.setDate(today.getDate()-wd);
  let weekDone=0,weekTotal=0;
  for(let i=0;i<7;i++){
    const d=new Date(weekStart);
    d.setDate(weekStart.getDate()+i);
    const key=dateKey(d);
    const logs=data.logs[key]||{};
    weekDone+=Object.values(logs).filter(v=>v).length;
    weekTotal+=data.habits.length;
  }
  document.getElementById("weekStat").textContent=percent(weekDone,weekTotal)+"%";

  // month
  let mDone=0,mTotal=0;
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  for(let i=1;i<=daysInMonth;i++){
    const key=dateKey(new Date(currentYear,currentMonth,i));
    const logs=data.logs[key]||{};
    mDone+=Object.values(logs).filter(v=>v).length;
    mTotal+=data.habits.length;
  }
  document.getElementById("monthStat").textContent=percent(mDone,mTotal*daysInMonth/data.habits.length)+"%";

  // year
  let yDone=0,yTotal=0;
  for(let m=0;m<12;m++){
    const dCount=new Date(currentYear,m+1,0).getDate();
    for(let i=1;i<=dCount;i++){
      const key=dateKey(new Date(currentYear,m,i));
      const logs=data.logs[key]||{};
      yDone+=Object.values(logs).filter(v=>v).length;
      yTotal+=data.habits.length;
    }
  }
  document.getElementById("yearStat").textContent=percent(yDone,yTotal)+"%";
}

// ---------- Init + Year Handling ----------
function checkYear(){
  const now=new Date();
  if(now.getFullYear()!==currentYear){
    currentYear=now.getFullYear();
    data=loadYear();
  }
}
setInterval(checkYear,60*1000);

renderHabits();
renderCalendar();
updateStats();

// Keyboard add habit
document.getElementById("habitInput").addEventListener("keydown",e=>{
  if(e.key==="Enter") addHabit();
});
</script>
</body>
</html>
